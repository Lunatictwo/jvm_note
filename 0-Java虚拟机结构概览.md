# Java 虚拟机结构
书中介绍的是概念上的虚拟机实现，而不是任何一种具体的JVM实现。

## Class 文件格式
.class 文件格式通常以文件的形式存储（也有可能是其他形式），同时定义了类／借口的形式，还有限定了字节序，使之平台无关（字节序在不同机器上可能有大小端的问题）。

## 数据类型
JVM处理的数据包括 原始类型和引用类型。
同时，JVM希望在编译期间就进行尽可能多的类型检查，从而直接在虚拟机运行期间直接操作原始类型的数据。
另外，JVM也直接支持对象，不论是动态分配的类实例还是数组，etc。

## 原始类型
JVM支持的原始类型包括    
一、数值类型    
  1. 整数类型    
    byte, short, int, long, char    
  2. 浮点类型    
    float, double    
    需要注意的是NaN类型，属于浮点数中的一种特殊情况，用来表示某些无效的情况，比如 0/0 。NaN进行任何数值比较和等值测试都会返回 false，包括和自身比较。但是任何数字如果和NaN进行不等值比较，返回true。        

二、boolean类型    
JVM中对boolean的支持很有限，没有为boolean提供专用的字节码指令，所以Java代码中的boolean值在编译之后，都会转换为JVM中的int（0，1）数据类型。

三、returnAddress类型    
比较特殊，值某个操作码（opcode）的指针。    
returnAddress 类型的值指向一条虚拟机指令的操作码。returnAddress在 Java 中并不存在，所以它的生存周期也只是在JVM中，同时也无法在运行时更改。    
*注：returnAddress会被JVM中的某些指令使用，但是在JDK 7中，已经不允许这些指令存在与class文件中，因此returnAddress 可以视为被废弃。

## 引用类型与值    
 JVM中有三种引用类型：类类型，数组类型，接口类型。      
 数组类型最外层的一维元素类型，叫做数组类型的组件类型，组件类型也可以是数组，那么一个 N 维的数组可以看成多个组件类型的嵌套结构。同时，最内层的组件类型的单元数据叫做 元素类型。最小粒度的元素 类型必须是原声类型、类类型或者是接口类型之一。   
NULL：当一个引用不指向任何对象的时候，它的值用null来表示。一个为null的引用，它不具有任何实际的运行期类型，但是可以转换为任意的引用类型，引用类型的默认值这里可以看成是null。

## 运行时数据区
 1. PC寄存器（Program counter）    
 JVM在多线程执行的时候，每一个JVM虚拟机线程都有自己的PC寄存器，在任一特定时刻，每一个线程都只会执行一个方法的代码，这个方法被称为该线程的当前方法。    
 如果该当前方法（current method）是native的，即该方法是调用的非Java代码的接口，那么pc寄存器的值是undefined。    
 如果方法不是native的，即调用的是Java方法，那么px寄存器的值是正在执行的字节码指令的地址。    
关于Java的native method 可以参考：https://stackoverflow.com/questions/6101311/what-is-the-native-keyword-in-java-for
 2.JVM栈
 虚拟机中的栈主要是用来存储栈帧及局部变量、临时计算结果。
 如果线程请求分配的栈容量超过JVM允许的最大栈容量，那么会抛出StackOverFlowError异常；如果创建新线程时没有足够的内存去创建对应的虚拟机栈，那么会抛出OOM的异常。
 








===
